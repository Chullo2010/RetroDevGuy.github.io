<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Bloxybob Games – Chat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    /* === Pixel Asteroid Background Canvas === */
    #starsCanvas {
        position: fixed;
        top:0;
        left:0;
        width:100%;
        height:100%;
        z-index:-1;
        background:black;
    }

    body { 
        color:#e8e8ff; 
        font-family:sans-serif; 
        margin:0; 
        padding-top: 110px;
        padding-bottom: 50px;
    }
    
    /* --- TOP SITE HEADER --- */
    #siteHeader {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: 60px;
        background: #0c0c12;
        border-bottom: 2px solid #333;
        display:flex;
        align-items:center;
        padding-left:20px;
        font-size: 22px;
        font-weight:bold;
        z-index: 9999;
        letter-spacing: 2px;
    }

    /* --- CHAT HEADER --- */
    header { 
        padding:10px 20px; 
        background: #121212;
        border-bottom:1px solid #333;
        display:flex; 
        justify-content:space-between; 
        align-items:center;
        position: fixed; 
        top: 60px;
        left: 0;
        right: 0;
        z-index: 9998;
        font-weight: bold;
    }

    .btn { 
        padding: 5px 10px; 
        background:transparent; 
        color:#b0b0b0; 
        cursor:pointer; 
        margin-left:5px;
        border:none;
    }
    .btn:hover {
        background: rgba(255,255,255,0.05); 
    }

    #boardContent { 
        padding: 0 20px; 
        max-height: calc(100vh - 160px);
        overflow-y:auto;
    }
    #boardContent div { 
        padding: 8px 0;
        background: transparent;
        border-bottom: 1px solid #1a1a1a;
    }

    #controlBar {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: #121212;
        padding: 5px 20px; 
        border-top: 1px solid #333; 
        display:flex;
        align-items:center;
        z-index: 9999;
    }

    #userMessage {
        padding: 8px 10px;
        border-radius: 4px;
        border: 1px solid #333;
        background: #0b0b0f;
        color:#e8e8ff;
        flex-grow: 1;
        margin-right:10px;
    }

    /* Username popup */
    #usernamePrompt {
        display:flex;
        position:fixed;
        top:0;
        left:0;
        width:100%;
        height:100%;
        background: rgba(0,0,0,0.9);
        z-index:10000;
        justify-content:center;
        align-items:center;
        flex-direction:column;
    }

  </style>
</head>

<body>

<!-- ⭐ Pixel Asteroid Background -->
<canvas id="starsCanvas"></canvas>

<!-- ⭐ NEW WEBSITE HEADER -->
<div id="siteHeader">Script Libary</div>

<!-- ORIGINAL CHAT HEADER -->
<header>
  <strong>Chatting</strong>
  <div id="adminBadge" style="display:none;">Admin Mode Active</div>
</header>

<!-- Username Prompt -->
<div id="usernamePrompt">
  <h2>Choose a Username</h2>
  <input type="text" id="usernameInput" placeholder="Enter your name" maxlength="20" />
  <button id="submitUsername" class="btn">Start Chatting</button>
  <div id="usernameError" style="color:#ffb3b3;margin-top:10px;display:none;">Username must be 3-20 characters long.</div>
</div>

<main>
    <div id="boardContent"></div>

    <div style="padding: 0 20px;">
        <div id="lastUpdated"></div>
        <div id="errorBox" style="display:none;"></div>
        <div id="successBox" style="display:none;"></div>
    </div>
</main>

<div id="controlBar">
    <input type="text" id="userMessage" placeholder="Enter message..." />
    <button id="postMessage" class="btn">Post</button>
    <button id="clearBoard" class="btn">Clear Board (Admin Only)</button>
</div>

<script>
/* === STARFIELD BACKGROUND === */
const canvas = document.getElementById("starsCanvas");
const ctx = canvas.getContext("2d");

function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
resizeCanvas();
window.onresize = resizeCanvas;

const ast = [];
for (let i = 0; i < 200; i++) {
    ast.push({
        x: Math.random()*canvas.width,
        y: Math.random()*canvas.height,
        speed: 0.5 + Math.random()*1.5,
        size: 2 + Math.random()*3,
    });
}

function drawStars() {
    ctx.fillStyle = "black";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    ctx.fillStyle = "#9fa8ff";
    for (let a of ast) {
        ctx.fillRect(a.x, a.y, a.size, a.size);
        a.y += a.speed;
        if (a.y > canvas.height) {
            a.y = -5;
            a.x = Math.random()*canvas.width;
        }
    }
    requestAnimationFrame(drawStars);
}
drawStars();

/* === JSONBIN CONFIG === */
const BIN_ID = "691bba8b43b1c97be9b417f5";
const API_KEY = "$2a$10$.tBrIgAoBvAR0OBWn3KOVOAInJMjMtAQLAdN38xOkvy/YL0tRY/kC";
const API_URL_READ = `https://api.jsonbin.io/v3/b/${BIN_ID}/latest`;
const API_URL_WRITE = `https://api.jsonbin.io/v3/b/${BIN_ID}`;

/* === ADMIN PASSWORD === */
const ADMIN_PASSWORD = "admin123";   // ← change this to whatever you want
let isAdmin = false;

/* === USERNAME LOGIN === */
let username = "";

document.getElementById("submitUsername").onclick = () => {
    const input = document.getElementById("usernameInput").value.trim();

    if (input.length < 3 || input.length > 20) {
        document.getElementById("usernameError").style.display = "block";
        return;
    }

    username = input;

    // Enable Admin Mode if username matches
    if (username.toLowerCase() === "admin") {
        isAdmin = true;
        document.getElementById("adminBadge").style.display = "block";
    }

    document.getElementById("usernamePrompt").style.display = "none";
};

/* === LOAD MESSAGES === */
async function loadMessages() {
    try {
        const res = await fetch(API_URL_READ, {
            headers: { "X-Master-Key": API_KEY }
        });

        const data = await res.json();
        const messages = data.record.messages || [];

        const board = document.getElementById("boardContent");
        board.innerHTML = "";

        messages.forEach(msg => {
            const div = document.createElement("div");
            div.textContent = `${msg.user}: ${msg.text}`;
            board.appendChild(div);
        });

    } catch (err) {
        console.log("Load error:", err);
    }
}

/* === POST MESSAGE === */
async function postMessage() {
    if (!username) return;

    const text = document.getElementById("userMessage").value.trim();
    if (text.length === 0) return;

    const res = await fetch(API_URL_READ, {
        headers: { "X-Master-Key": API_KEY }
    });

    const data = await res.json();
    const messages = data.record.messages || [];

    messages.push({ user: username, text });

    await fetch(API_URL_WRITE, {
        method: "PUT",
        headers: {
            "Content-Type": "application/json",
            "X-Master-Key": API_KEY
        },
        body: JSON.stringify({ messages })
    });

    document.getElementById("userMessage").value = "";
    loadMessages();
}

document.getElementById("postMessage").onclick = postMessage;

/* === CLEAR BOARD (ADMIN ONLY) === */
document.getElementById("clearBoard").onclick = async () => {

    if (!isAdmin) {
        alert("Only Admin can clear the board!");
        return;
    }

    const entered = prompt("Enter admin password to clear board:");

    if (entered !== ADMIN_PASSWORD) {
        alert("Incorrect password.");
        return;
    }

    await fetch(API_URL_WRITE, {
        method: "PUT",
        headers: {
            "Content-Type": "application/json",
            "X-Master-Key": API_KEY
        },
        body: JSON.stringify({ messages: [] })
    });

    loadMessages();
    alert("Board cleared!");
};

/* Auto refresh every 2 seconds */
setInterval(loadMessages, 2000);
loadMessages();
</script>
